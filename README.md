# Usage

### Step 0

Uncomment the appropriate sections and product_names in main.py to choose which phase / products to run.

Can modify to accept arguments.

### Step 1

Simulate a dataset with various features and save it in data/output/customers.csv

Feature distributions need to be researched for realism or can be eyeballed, but the relationship between the feature and label in the next phase is more important.

### Step 2

Add labels to the dataset and save it as data/output/customers_{product_name}.csv

Labels are generated by generating the probability for a label for each feature, and then summing them. This is the most important part, and has to be eyeballed. It can / should be tweaked / experimented with as necessary.

Can modify to generate a single csv instead of one for each product_name. Or modify to have only a single column in the newly generated csv, and then combine in the next step.

### Step 3

Train the model using the generated features and labels and save the model in data/model_{product_name}.pkl

One model for each product, not much time was spent here. Feel free to modify as necessary.

### Step 4

The code deploys the model by 

1) uploading the pkl files to the bank_prototype storage bucket in GCP
2) uploading the model as a new version in Vertex AI Model Registry
3) creating an endpoint using a slightly custom (to change the format of the prediction request json) docker container stored in the artifact registry (code has been provided in the app folder)
4) uploading the latest model version to the endpoint

### Step 5

Send a prediction request using the schema provided in /test_request to the endpoint (obtained from the endpoint in Vertex AI).

### Step 6

Undeploy (or delete endpoint) by running undeploy.py

# Inputs

### Modify features

To modify the existing distribution of features, change the weights in data/weights

To add new features

1) create a csv file in data/weights
2) load them data_simulation/features.py
3) create a Dynamic Provider in providers.py
4) add them as a property to the Customer Class in Customer.py
5) add them in data_labeling/labels/{product_name}.py and modify the probabilities accordingly.
6) add them in data_modeling/labels/{product_name}.py
7) add them in data_modeling/deployments/{product_name.py}

This part may need to be refactored to keep it DRY.

### Notes

Model selection is not as important here as the label simulation, as the probability distribution should be easily capturable given that there are no exogenuous relations.
Some parts are repetitive and can be refactored as this was originally intended to be a short-term stopgap until we obtain the actual data.